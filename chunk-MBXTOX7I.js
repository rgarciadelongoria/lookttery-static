import{c as m}from"./chunk-POLL2CVR.js";import{bootstrapApplication as Ot}from"@angular/platform-browser";import{provideRouter as wt}from"@angular/router";import{CommonModule as ot}from"@angular/common";import"@angular/core";import{RouterModule as rt}from"@angular/router";import{IonicModule as nt}from"@ionic/angular";var f=function(o){return o.SHELL_DEVICE_GET_ID="shellDeviceGetId",o.SHELL_SCANNER_RESPONSE="shellScannerResponse",o.SHELL_SCANNER_START="shellScannerStart",o.SHELL_SCANNER_STOP="shellScannerStop",o.SHELL_SCANNER_ERROR="shellScannerError",o.SHELL_DEVICE_GET_ID_RESPONSE="shellDeviceGetIdResponse",o}(f||{}),O=function(o){return o.SHELL_LOADING_REMOTE_OK="shellLoadingRemoteOk",o}(O||{});import*as s from"@angular/core";import*as H from"@angular/router";import"@angular/core";var v={api:{host:"https://api.lookttery.com:3000/api"}};import{lastValueFrom as et}from"rxjs";import*as k from"@angular/core";import{HttpHeaders as Z}from"@angular/common/http";import"@angular/core";import{catchError as X,throwError as tt}from"rxjs";var S=function(o){return o.TOKEN="token",o}(S||{}),g=function(o){return o.SYSTEM="[SYSTEM]",o}(g||{}),C=function(o){return o.UUID_EMAIL_DOMAIN="@uuid.app",o}(C||{});import*as y from"@angular/core";import*as N from"@angular/common/http";import*as j from"@angular/router";import"@angular/core";import*as L from"@angular/core";var E=(()=>{let i=class i{constructor(){}setItem(e,t){localStorage.setItem(e,t)}getItem(e){try{return JSON.parse(localStorage.getItem(e)||"")}catch{return localStorage.getItem(e)}}removeItem(e){localStorage.removeItem(e)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=L.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var A=function(o){return o.UNAUTHORIZED="Unauthorized",o}(A||{}),u=(()=>{let i=class i{constructor(e,t,r){this.http=e,this.router=t,this.storageSrv=r}get(e,t){return t=this.addTokenToHeaders(t),this.http.get(e,t)}post(e,t,r){return r=this.addPostHeaders(r),r=this.addTokenToHeaders(r),this.http.post(e,t,r).pipe(this.handleErrorAndRedirect())}addTokenToHeaders(e){let r=[["Authorization",`Bearer ${this.storageSrv.getItem(S.TOKEN)?.token}`]];return this.addHeaders(r,e)}addPostHeaders(e){let t=[["Content-Type","application/json"]];return this.addHeaders(t,e)}addHeaders(e,t){return e.forEach(r=>{t=t||{},t.headers=t.headers||{},t.headers instanceof Z?t.headers=t.headers.append(r[0],r[1]):typeof t.headers=="object"&&(t.headers[r[0]]=r[1])}),t||{}}handleErrorAndRedirect(){return X((e,t)=>m(this,null,function*(){return e.status===401&&e.statusText===A.UNAUTHORIZED&&(this.storageSrv.removeItem(S.TOKEN),this.router.navigate(["/","main"])),tt(e)}))}};i.\u0275fac=function(t){return new(t||i)(y.\u0275\u0275inject(N.HttpClient),y.\u0275\u0275inject(j.Router),y.\u0275\u0275inject(E))},i.\u0275prov=y.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var w=(()=>{let i=class i{constructor(e){this.apiSrv=e,this.apiTicket=`${v.api.host}/ticket`}createTicket(e){return m(this,null,function*(){let t={data:{info:{code:e}}};try{let r=this.apiSrv.post(this.apiTicket,t);return yield et(r)}catch(r){throw r}})}};i.\u0275fac=function(t){return new(t||i)(k.\u0275\u0275inject(u))},i.\u0275prov=k.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function st(o,i){o&1&&s.\u0275\u0275element(0,"article",3)}function at(o,i){o&1&&(s.\u0275\u0275elementStart(0,"article"),s.\u0275\u0275text(1,"Camera permission denied."),s.\u0275\u0275elementEnd())}var P=(()=>{let i=class i{handleShellScannerResponse(e){return m(this,null,function*(){yield this.onScannerResponse(e.detail?.response||{})})}handleShellScannerError(e){return m(this,null,function*(){yield this.onScannerError(e.detail?.response||{})})}constructor(e,t){this.router=e,this.ticketSrv=t,this.responses=[],this.hasPermission=!0}ngOnInit(){}ionViewDidEnter(){this.startScan()}ionViewWillLeave(){this.stopScan()}startScan(){this.hasPermission=!0,window.dispatchEvent(new CustomEvent(f.SHELL_SCANNER_START))}stopScan(){window.dispatchEvent(new CustomEvent(f.SHELL_SCANNER_STOP))}onScannerResponse(e){return m(this,null,function*(){let t=yield this.ticketSrv.createTicket(e.content||"");this.exit()})}onScannerError(e){return m(this,null,function*(){console.log(e),this.hasPermission=!1})}exit(){this.router.navigate(["/main/","tickets"])}};i.\u0275fac=function(t){return new(t||i)(s.\u0275\u0275directiveInject(H.Router),s.\u0275\u0275directiveInject(w))},i.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["app-scan"]],hostBindings:function(t,r){t&1&&s.\u0275\u0275listener("shellScannerResponse",function(d){return r.handleShellScannerResponse(d)},!1,s.\u0275\u0275resolveWindow)("shellScannerError",function(d){return r.handleShellScannerError(d)},!1,s.\u0275\u0275resolveWindow)},standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:4,vars:1,consts:[[1,"scan"],[1,"scan-screen"],["class","scan-screen-pointer square-div"],[1,"scan-screen-pointer","square-div"]],template:function(t,r){t&1&&(s.\u0275\u0275elementStart(0,"section",0)(1,"section",1),s.\u0275\u0275template(2,st,1,0,"article",2)(3,at,2,0),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275conditional(2,r.hasPermission?2:3))},dependencies:[ot,rt,nt],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .scan[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:100vh;margin:0}[_nghost-%COMP%]   .scan-controls[_ngcontent-%COMP%]{width:100%;padding:20px}[_nghost-%COMP%]   .scan-controls[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:44px}[_nghost-%COMP%]   .scan-screen[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%}[_nghost-%COMP%]   .scan-screen-pointer[_ngcontent-%COMP%]{width:calc(100% - 40px);max-width:400px;height:calc(100% - 40px);max-height:400px;background-color:#00000026;border:10px rgba(255,217,0,.55) solid;border-radius:15px}"],changeDetection:0});let o=i;return o})();import{CommonModule as ct}from"@angular/common";import"@angular/core";import{RouterModule as mt}from"@angular/router";import{IonicModule as pt}from"@ionic/angular";import*as c from"@angular/core";import*as p from"@ionic/angular";var lt=["mainTabs"],$=(()=>{let i=class i{constructor(){}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.mainTabs.select("scan")},500)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=c.\u0275\u0275defineComponent({type:i,selectors:[["app-main"]],viewQuery:function(t,r){if(t&1&&c.\u0275\u0275viewQuery(lt,5),t&2){let a;c.\u0275\u0275queryRefresh(a=c.\u0275\u0275loadQuery())&&(r.mainTabs=a.first)}},standalone:!0,features:[c.\u0275\u0275StandaloneFeature],decls:14,vars:0,consts:[["mainTabs",""],["slot","bottom"],["tab","scan"],["name","scan-outline"],["tab","tickets"],["name","wallet-outline"]],template:function(t,r){t&1&&(c.\u0275\u0275elementStart(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),c.\u0275\u0275text(3,"Lookttery"),c.\u0275\u0275elementEnd()()(),c.\u0275\u0275element(4,"ion-router-outlet"),c.\u0275\u0275elementStart(5,"ion-tabs",null,0)(7,"ion-tab-bar",1)(8,"ion-tab-button",2),c.\u0275\u0275element(9,"ion-icon",3),c.\u0275\u0275text(10," Scan Now "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"ion-tab-button",4),c.\u0275\u0275element(12,"ion-icon",5),c.\u0275\u0275text(13," Tickets "),c.\u0275\u0275elementEnd()()())},dependencies:[ct,mt,pt,p.IonHeader,p.IonIcon,p.IonTabBar,p.IonTabButton,p.IonTitle,p.IonToolbar,p.IonTabs,p.IonRouterOutlet],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let o=i;return o})();import{CommonModule as ht}from"@angular/common";import{HttpClientModule as ft}from"@angular/common/http";import"@angular/core";import{NavigationEnd as St,RouterModule as vt}from"@angular/router";import{filter as gt}from"rxjs";import{IonicModule as Et}from"@ionic/angular";import"@angular/core";import{lastValueFrom as F}from"rxjs";import*as T from"@angular/core";import"@angular/core";import{lastValueFrom as b}from"rxjs";import*as D from"@angular/core";var dt=1e3*60*60*1.5,h=(()=>{let i=class i{constructor(e,t){this.apiSrv=e,this.storageSrv=t,this.apiUser=`${v.api.host}/user`}createUserByUuid(e){return m(this,null,function*(){let t={email:`${e}${C.UUID_EMAIL_DOMAIN}`,password:e,name:e};try{let r=this.apiSrv.post(this.apiUser,t);return yield b(r)}catch(r){throw r}})}loginByUuid(e){return m(this,null,function*(){return yield this.login(`${e}${C.UUID_EMAIL_DOMAIN}`,e)})}login(e,t){return m(this,null,function*(){let r={email:e,password:t};try{let a=this.apiSrv.post(`${this.apiUser}/login`,r),d=yield b(a);if(d.token){let W={token:d.token,date:Date.now()};this.storageSrv.setItem(S.TOKEN,JSON.stringify(W)),console.info(g.SYSTEM,`${d.token}`)}return d}catch(a){throw a}})}checkTokenExpiration(e){return m(this,null,function*(){let r=this.storageSrv.getItem(S.TOKEN)?.date||0;Date.now()-r>dt&&(yield this.loginByUuid(e))})}getAllTicketsByUser(){return m(this,null,function*(){try{let e=this.apiSrv.get(`${this.apiUser}/ticket/all?limit=100&offset=0`);return yield b(e)}catch{return[]}})}};i.\u0275fac=function(t){return new(t||i)(D.\u0275\u0275inject(u),D.\u0275\u0275inject(E))},i.\u0275prov=D.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var M=(()=>{let i=class i{constructor(e,t){this.apiSrv=e,this.userSrv=t,this.uuid="",this.apiUuid=`${v.api.host}/uuid`,window.addEventListener(f.SHELL_DEVICE_GET_ID_RESPONSE,r=>m(this,null,function*(){yield this.onDeviceIdResponse(r.detail?.response||{})}))}init(){this.requestDeviceId()}getUuid(){return this.uuid}requestDeviceId(){window.dispatchEvent(new CustomEvent(f.SHELL_DEVICE_GET_ID))}onDeviceIdResponse(e){return m(this,null,function*(){this.uuid=e||"",(yield this.getUuidData())?(yield this.userSrv.loginByUuid(this.uuid),console.info(g.SYSTEM,`UUID ${this.uuid} was registered.`)):yield this.registerUuid()})}getUuidData(){return m(this,null,function*(){try{let e=this.apiSrv.get(`${this.apiUuid}/${this.uuid}`);return yield F(e)}catch{return null}})}registerUuid(){return m(this,null,function*(){let e=yield this.userSrv.createUserByUuid(this.uuid);if((yield this.userSrv.loginByUuid(this.uuid)).token){let r={uuid:this.uuid,user:e._id};try{let a=this.apiSrv.post(this.apiUuid,r),d=yield F(a);this.uuid=d.uuid,console.info(g.SYSTEM,`UUID ${this.uuid} has been registered.`)}catch(a){console.error(a)}}})}};i.\u0275fac=function(t){return new(t||i)(T.\u0275\u0275inject(u),T.\u0275\u0275inject(h))},i.\u0275prov=T.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();import*as l from"@angular/core";import*as x from"@angular/router";var B=(()=>{let i=class i{constructor(e,t,r,a){this.uuidSrv=e,this.userSrv=t,this.storageSrv=r,this.router=a}ngOnInit(){this.setNoErrorLoadingRemote(),this.importStyles(),this.importScripts(),this.uuidSrv.init(),this.router.events.pipe(gt(e=>e instanceof St)).subscribe(e=>{let t=this.uuidSrv.getUuid();t?this.userSrv.checkTokenExpiration(t):this.uuidSrv.init()})}setNoErrorLoadingRemote(){this.storageSrv.setItem(O.SHELL_LOADING_REMOTE_OK,!0)}importScripts(){let e=["https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js","https://cdn.jsdelivr.net/npm/ionicons/dist/ionicons/ionicons.esm.js"],t=document.head;e.forEach(r=>{let a=document.createElement("script");a.type="module",a.src=r,a.async=!1,document.head.appendChild(a),t.insertBefore(a,t.firstElementChild)})}importStyles(){let e=["https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"],t=document.head;e.forEach(r=>{let a=document.createElement("link");a.rel="stylesheet",a.href=r,t.insertBefore(a,t.firstElementChild)})}};i.\u0275fac=function(t){return new(t||i)(l.\u0275\u0275directiveInject(M),l.\u0275\u0275directiveInject(h),l.\u0275\u0275directiveInject(E),l.\u0275\u0275directiveInject(x.Router))},i.\u0275cmp=l.\u0275\u0275defineComponent({type:i,selectors:[["app-remote-app"]],standalone:!0,features:[l.\u0275\u0275ProvidersFeature([u,M,h,w]),l.\u0275\u0275StandaloneFeature],decls:1,vars:0,template:function(t,r){t&1&&l.\u0275\u0275element(0,"router-outlet")},dependencies:[ht,vt,x.RouterOutlet,Et,ft],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let o=i;return o})();import{CommonModule as yt}from"@angular/common";import"@angular/core";import{RouterModule as It}from"@angular/router";import{IonicModule as Dt}from"@ionic/angular";import*as n from"@angular/core";import*as K from"@angular/common";import*as V from"@ionic/angular";var Tt=(o,i)=>i._id;function Ct(o,i){if(o&1&&(n.\u0275\u0275text(0,`
        `),n.\u0275\u0275elementStart(1,"p"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"json"),n.\u0275\u0275elementEnd(),n.\u0275\u0275text(4,`
    `)),o&2){let J=i.$implicit;n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,1,J))}}function kt(o,i){o&1&&(n.\u0275\u0275text(0,`
        `),n.\u0275\u0275elementStart(1,"p"),n.\u0275\u0275text(2,"Empty list of users"),n.\u0275\u0275elementEnd(),n.\u0275\u0275text(3,`
    `))}var G=(()=>{let i=class i{constructor(e,t){this.cdr=e,this.userSrv=t,this.tickets=[]}ngOnInit(){}ionViewDidEnter(){return m(this,null,function*(){yield this.getUserTickets()})}getUserTickets(){return m(this,null,function*(){this.tickets=yield this.userSrv.getAllTicketsByUser(),console.log(this.tickets),this.cdr.detectChanges()})}};i.\u0275fac=function(t){return new(t||i)(n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(h))},i.\u0275cmp=n.\u0275\u0275defineComponent({type:i,selectors:[["app-tickets"]],standalone:!0,features:[n.\u0275\u0275StandaloneFeature],decls:6,vars:2,consts:[[3,"fullscreen"]],template:function(t,r){t&1&&(n.\u0275\u0275elementStart(0,"ion-content",0)(1,"pre"),n.\u0275\u0275text(2,"    "),n.\u0275\u0275repeaterCreate(3,Ct,5,3,null,null,Tt,!1,kt,4,0),n.\u0275\u0275elementEnd()()),t&2&&(n.\u0275\u0275property("fullscreen",!0),n.\u0275\u0275advance(3),n.\u0275\u0275repeater(r.tickets))},dependencies:[yt,K.JsonPipe,It,Dt,V.IonContent],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{height:100vh;width:100vw}"],changeDetection:0});let o=i;return o})();var q=[{path:"",component:B,children:[{path:"",redirectTo:"main",pathMatch:"full"},{path:"main",component:$,children:[{path:"scan",component:P},{path:"tickets",component:G}]}]}];var Y={providers:[wt(q)]};import"@angular/core";import{CommonModule as Mt}from"@angular/common";import{RouterModule as xt}from"@angular/router";import*as I from"@angular/core";import*as Q from"@angular/router";var z=(()=>{let i=class i{constructor(){this.title="lookttery-app"}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I.\u0275\u0275defineComponent({type:i,selectors:[["app-root"]],standalone:!0,features:[I.\u0275\u0275StandaloneFeature],decls:1,vars:0,template:function(t,r){t&1&&I.\u0275\u0275element(0,"router-outlet")},dependencies:[Mt,xt,Q.RouterOutlet]});let o=i;return o})();Ot(z,Y).catch(o=>console.error(o));
