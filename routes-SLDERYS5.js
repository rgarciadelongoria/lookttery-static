var c=(i,d,t)=>new Promise((e,n)=>{var r=f=>{try{T(t.next(f))}catch(O){n(O)}},l=f=>{try{T(t.throw(f))}catch(O){n(O)}},T=f=>f.done?e(f.value):Promise.resolve(f.value).then(r,l);T((t=t.apply(i,d)).next())});import{CommonModule as X}from"@angular/common";import"@angular/core";import{RouterModule as tt}from"@angular/router";import{IonicModule as et}from"@ionic/angular";var S=function(i){return i.SHELL_DEVICE_GET_ID="shellDeviceGetId",i.SHELL_SCANNER_RESPONSE="shellScannerResponse",i.SHELL_SCANNER_START="shellScannerStart",i.SHELL_SCANNER_STOP="shellScannerStop",i.SHELL_SCANNER_ERROR="shellScannerError",i.SHELL_DEVICE_GET_ID_RESPONSE="shellDeviceGetIdResponse",i}(S||{}),R=function(i){return i.SHELL_LOADING_REMOTE_OK="shellLoadingRemoteOk",i}(R||{});import*as s from"@angular/core";import*as $ from"@angular/router";import"@angular/core";var g={api:{host:"https://api.lookttery.com:3000/api"}};import{lastValueFrom as W}from"rxjs";import*as k from"@angular/core";import{HttpHeaders as Q}from"@angular/common/http";import"@angular/core";import{catchError as z,throwError as J}from"rxjs";var v=function(i){return i.TOKEN="token",i}(v||{}),E=function(i){return i.SYSTEM="[SYSTEM]",i}(E||{}),_=function(i){return i.UUID_EMAIL_DOMAIN="@uuid.app",i}(_||{});import*as I from"@angular/core";import*as A from"@angular/common/http";import*as H from"@angular/router";import"@angular/core";import*as j from"@angular/core";var y=(()=>{class i{constructor(){}setItem(t,e){localStorage.setItem(t,e)}getItem(t){try{return JSON.parse(localStorage.getItem(t)||"")}catch{return localStorage.getItem(t)}}removeItem(t){localStorage.removeItem(t)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=j.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var P=function(i){return i.UNAUTHORIZED="Unauthorized",i}(P||{}),u=(()=>{class i{constructor(t,e,n){this.http=t,this.router=e,this.storageSrv=n}get(t,e){return e=this.addTokenToHeaders(e),this.http.get(t,e)}post(t,e,n){return n=this.addPostHeaders(n),n=this.addTokenToHeaders(n),this.http.post(t,e,n).pipe(this.handleErrorAndRedirect())}addTokenToHeaders(t){let n=[["Authorization",`Bearer ${this.storageSrv.getItem(v.TOKEN)?.token}`]];return this.addHeaders(n,t)}addPostHeaders(t){let e=[["Content-Type","application/json"]];return this.addHeaders(e,t)}addHeaders(t,e){return t.forEach(n=>{e=e||{},e.headers=e.headers||{},e.headers instanceof Q?e.headers=e.headers.append(n[0],n[1]):typeof e.headers=="object"&&(e.headers[n[0]]=n[1])}),e||{}}handleErrorAndRedirect(){return z((t,e)=>c(this,null,function*(){return t.status===401&&t.statusText===P.UNAUTHORIZED&&(this.storageSrv.removeItem(v.TOKEN),this.router.navigate(["/","main"])),J(t)}))}static{this.\u0275fac=function(e){return new(e||i)(I.\u0275\u0275inject(A.HttpClient),I.\u0275\u0275inject(H.Router),I.\u0275\u0275inject(y))}}static{this.\u0275prov=I.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var w=(()=>{class i{constructor(t){this.apiSrv=t,this.apiTicket=`${g.api.host}/ticket`}createTicket(t){return c(this,null,function*(){let e={data:{info:{code:t}}};try{let n=this.apiSrv.post(this.apiTicket,e);return yield W(n)}catch(n){throw n}})}static{this.\u0275fac=function(e){return new(e||i)(k.\u0275\u0275inject(u))}}static{this.\u0275prov=k.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function it(i,d){i&1&&s.\u0275\u0275element(0,"article",3)}function nt(i,d){i&1&&(s.\u0275\u0275elementStart(0,"article"),s.\u0275\u0275text(1,"Camera permission denied."),s.\u0275\u0275elementEnd())}var F=(()=>{class i{handleShellScannerResponse(t){return c(this,null,function*(){yield this.onScannerResponse(t.detail?.response||{})})}handleShellScannerError(t){return c(this,null,function*(){yield this.onScannerError(t.detail?.response||{})})}constructor(t,e){this.router=t,this.ticketSrv=e,this.responses=[],this.hasPermission=!0}ngOnInit(){}ionViewDidEnter(){this.startScan()}ionViewWillLeave(){this.stopScan()}startScan(){this.hasPermission=!0,window.dispatchEvent(new CustomEvent(S.SHELL_SCANNER_START))}stopScan(){window.dispatchEvent(new CustomEvent(S.SHELL_SCANNER_STOP))}onScannerResponse(t){return c(this,null,function*(){let e=yield this.ticketSrv.createTicket(t.content||"");this.exit()})}onScannerError(t){return c(this,null,function*(){console.log(t),this.hasPermission=!1})}exit(){this.router.navigate(["/main/","tickets"])}static{this.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275directiveInject($.Router),s.\u0275\u0275directiveInject(w))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["app-scan"]],hostBindings:function(e,n){e&1&&s.\u0275\u0275listener("shellScannerResponse",function(l){return n.handleShellScannerResponse(l)},!1,s.\u0275\u0275resolveWindow)("shellScannerError",function(l){return n.handleShellScannerError(l)},!1,s.\u0275\u0275resolveWindow)},standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:4,vars:1,consts:[[1,"scan"],[1,"scan-screen"],["class","scan-screen-pointer square-div"],[1,"scan-screen-pointer","square-div"]],template:function(e,n){e&1&&(s.\u0275\u0275elementStart(0,"section",0)(1,"section",1),s.\u0275\u0275template(2,it,1,0,"article",2)(3,nt,2,0),s.\u0275\u0275elementEnd()()),e&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275conditional(2,n.hasPermission?2:3))},dependencies:[X,tt,et],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .scan[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:100vh;margin:0}[_nghost-%COMP%]   .scan-controls[_ngcontent-%COMP%]{width:100%;padding:20px}[_nghost-%COMP%]   .scan-controls[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:44px}[_nghost-%COMP%]   .scan-screen[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%}[_nghost-%COMP%]   .scan-screen-pointer[_ngcontent-%COMP%]{width:calc(100% - 40px);max-width:400px;height:calc(100% - 40px);max-height:400px;background-color:#00000026;border:10px rgba(255,217,0,.55) solid;border-radius:15px}"],changeDetection:0})}}return i})();import{CommonModule as ot}from"@angular/common";import"@angular/core";import{RouterModule as rt}from"@angular/router";import{IonicModule as st}from"@ionic/angular";import*as a from"@angular/core";import*as m from"@ionic/angular";var at=["mainTabs"],B=(()=>{class i{constructor(){}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.mainTabs.select("scan")},500)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=a.\u0275\u0275defineComponent({type:i,selectors:[["app-main"]],viewQuery:function(e,n){if(e&1&&a.\u0275\u0275viewQuery(at,5),e&2){let r;a.\u0275\u0275queryRefresh(r=a.\u0275\u0275loadQuery())&&(n.mainTabs=r.first)}},standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:14,vars:0,consts:[["mainTabs",""],["slot","bottom"],["tab","scan"],["name","scan-outline"],["tab","tickets"],["name","wallet-outline"]],template:function(e,n){e&1&&(a.\u0275\u0275elementStart(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a.\u0275\u0275text(3,"Lookttery"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275element(4,"ion-router-outlet"),a.\u0275\u0275elementStart(5,"ion-tabs",null,0)(7,"ion-tab-bar",1)(8,"ion-tab-button",2),a.\u0275\u0275element(9,"ion-icon",3),a.\u0275\u0275text(10," Scan Now "),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(11,"ion-tab-button",4),a.\u0275\u0275element(12,"ion-icon",5),a.\u0275\u0275text(13," Tickets "),a.\u0275\u0275elementEnd()()())},dependencies:[ot,rt,st,m.IonHeader,m.IonIcon,m.IonTabBar,m.IonTabButton,m.IonTitle,m.IonToolbar,m.IonTabs,m.IonRouterOutlet],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return i})();import{CommonModule as pt}from"@angular/common";import{HttpClientModule as lt}from"@angular/common/http";import"@angular/core";import{NavigationEnd as dt,RouterModule as ut}from"@angular/router";import{filter as ht}from"rxjs";import{IonicModule as ft}from"@ionic/angular";import"@angular/core";import{lastValueFrom as K}from"rxjs";import*as D from"@angular/core";import"@angular/core";import{lastValueFrom as L}from"rxjs";import*as C from"@angular/core";var ct=1e3*60*60*1.5,h=(()=>{class i{constructor(t,e){this.apiSrv=t,this.storageSrv=e,this.apiUser=`${g.api.host}/user`}createUserByUuid(t){return c(this,null,function*(){let e={email:`${t}${_.UUID_EMAIL_DOMAIN}`,password:t,name:t};try{let n=this.apiSrv.post(this.apiUser,e);return yield L(n)}catch(n){throw n}})}loginByUuid(t){return c(this,null,function*(){return yield this.login(`${t}${_.UUID_EMAIL_DOMAIN}`,t)})}login(t,e){return c(this,null,function*(){let n={email:t,password:e};try{let r=this.apiSrv.post(`${this.apiUser}/login`,n),l=yield L(r);if(l.token){let T={token:l.token,date:Date.now()};this.storageSrv.setItem(v.TOKEN,JSON.stringify(T)),console.info(E.SYSTEM,`${l.token}`)}return l}catch(r){throw r}})}checkTokenExpiration(t){return c(this,null,function*(){let n=this.storageSrv.getItem(v.TOKEN)?.date||0;Date.now()-n>ct&&(yield this.loginByUuid(t))})}getAllTicketsByUser(){return c(this,null,function*(){try{let t=this.apiSrv.get(`${this.apiUser}/ticket/all?limit=100&offset=0`);return yield L(t)}catch{return[]}})}static{this.\u0275fac=function(e){return new(e||i)(C.\u0275\u0275inject(u),C.\u0275\u0275inject(y))}}static{this.\u0275prov=C.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var M=(()=>{class i{constructor(t,e){this.apiSrv=t,this.userSrv=e,this.uuid="",this.apiUuid=`${g.api.host}/uuid`,window.addEventListener(S.SHELL_DEVICE_GET_ID_RESPONSE,n=>c(this,null,function*(){yield this.onDeviceIdResponse(n.detail?.response||{})}))}init(){this.requestDeviceId()}getUuid(){return this.uuid}requestDeviceId(){window.dispatchEvent(new CustomEvent(S.SHELL_DEVICE_GET_ID))}onDeviceIdResponse(t){return c(this,null,function*(){this.uuid=t||"",(yield this.getUuidData())?(yield this.userSrv.loginByUuid(this.uuid),console.info(E.SYSTEM,`UUID ${this.uuid} was registered.`)):yield this.registerUuid()})}getUuidData(){return c(this,null,function*(){try{let t=this.apiSrv.get(`${this.apiUuid}/${this.uuid}`);return yield K(t)}catch{return null}})}registerUuid(){return c(this,null,function*(){let t=yield this.userSrv.createUserByUuid(this.uuid);if((yield this.userSrv.loginByUuid(this.uuid)).token){let n={uuid:this.uuid,user:t._id};try{let r=this.apiSrv.post(this.apiUuid,n),l=yield K(r);this.uuid=l.uuid,console.info(E.SYSTEM,`UUID ${this.uuid} has been registered.`)}catch(r){console.error(r)}}})}static{this.\u0275fac=function(e){return new(e||i)(D.\u0275\u0275inject(u),D.\u0275\u0275inject(h))}}static{this.\u0275prov=D.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();import*as p from"@angular/core";import*as x from"@angular/router";var V=(()=>{class i{constructor(t,e,n,r){this.uuidSrv=t,this.userSrv=e,this.storageSrv=n,this.router=r}ngOnInit(){this.setNoErrorLoadingRemote(),this.importStyles(),this.importScripts(),this.uuidSrv.init(),this.router.events.pipe(ht(t=>t instanceof dt)).subscribe(t=>{let e=this.uuidSrv.getUuid();e?this.userSrv.checkTokenExpiration(e):this.uuidSrv.init()})}setNoErrorLoadingRemote(){this.storageSrv.setItem(R.SHELL_LOADING_REMOTE_OK,!0)}importScripts(){let t=["https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js","https://cdn.jsdelivr.net/npm/ionicons/dist/ionicons/ionicons.esm.js"],e=document.head;t.forEach(n=>{let r=document.createElement("script");r.type="module",r.src=n,r.async=!1,document.head.appendChild(r),e.insertBefore(r,e.firstElementChild)})}importStyles(){let t=["https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"],e=document.head;t.forEach(n=>{let r=document.createElement("link");r.rel="stylesheet",r.href=n,e.insertBefore(r,e.firstElementChild)})}static{this.\u0275fac=function(e){return new(e||i)(p.\u0275\u0275directiveInject(M),p.\u0275\u0275directiveInject(h),p.\u0275\u0275directiveInject(y),p.\u0275\u0275directiveInject(x.Router))}}static{this.\u0275cmp=p.\u0275\u0275defineComponent({type:i,selectors:[["app-remote-app"]],standalone:!0,features:[p.\u0275\u0275ProvidersFeature([u,M,h,w]),p.\u0275\u0275StandaloneFeature],decls:1,vars:0,template:function(e,n){e&1&&p.\u0275\u0275element(0,"router-outlet")},dependencies:[pt,ut,x.RouterOutlet,ft,lt],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return i})();import{CommonModule as St}from"@angular/common";import"@angular/core";import{RouterModule as vt}from"@angular/router";import{IonicModule as gt}from"@ionic/angular";import*as o from"@angular/core";import*as G from"@angular/common";import*as q from"@ionic/angular";var Et=(i,d)=>d._id;function yt(i,d){if(i&1&&(o.\u0275\u0275text(0,`
        `),o.\u0275\u0275elementStart(1,"p"),o.\u0275\u0275text(2),o.\u0275\u0275pipe(3,"json"),o.\u0275\u0275elementEnd(),o.\u0275\u0275text(4,`
    `)),i&2){let t=d.$implicit;o.\u0275\u0275advance(2),o.\u0275\u0275textInterpolate(o.\u0275\u0275pipeBind1(3,1,t))}}function It(i,d){i&1&&(o.\u0275\u0275text(0,`
        `),o.\u0275\u0275elementStart(1,"p"),o.\u0275\u0275text(2,"Empty list of users"),o.\u0275\u0275elementEnd(),o.\u0275\u0275text(3,`
    `))}var Y=(()=>{class i{constructor(t,e){this.cdr=t,this.userSrv=e,this.tickets=[]}ngOnInit(){}ionViewDidEnter(){return c(this,null,function*(){yield this.getUserTickets()})}getUserTickets(){return c(this,null,function*(){this.tickets=yield this.userSrv.getAllTicketsByUser(),console.log(this.tickets),this.cdr.detectChanges()})}static{this.\u0275fac=function(e){return new(e||i)(o.\u0275\u0275directiveInject(o.ChangeDetectorRef),o.\u0275\u0275directiveInject(h))}}static{this.\u0275cmp=o.\u0275\u0275defineComponent({type:i,selectors:[["app-tickets"]],standalone:!0,features:[o.\u0275\u0275StandaloneFeature],decls:6,vars:2,consts:[[3,"fullscreen"]],template:function(e,n){e&1&&(o.\u0275\u0275elementStart(0,"ion-content",0)(1,"pre"),o.\u0275\u0275text(2,"    "),o.\u0275\u0275repeaterCreate(3,yt,5,3,null,null,Et,!1,It,4,0),o.\u0275\u0275elementEnd()()),e&2&&(o.\u0275\u0275property("fullscreen",!0),o.\u0275\u0275advance(3),o.\u0275\u0275repeater(n.tickets))},dependencies:[St,G.JsonPipe,vt,gt,q.IonContent],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{height:100vh;width:100vw}"],changeDetection:0})}}return i})();var Be=[{path:"",component:V,children:[{path:"",redirectTo:"main",pathMatch:"full"},{path:"main",component:B,children:[{path:"scan",component:F},{path:"tickets",component:Y}]}]}];export{Be as routes};
