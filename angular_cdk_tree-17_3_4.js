import{SelectionModel as E,isDataSource as T}from"@angular/cdk/collections";import{isObservable as y,Subject as h,BehaviorSubject as b,of as w}from"rxjs";import{take as S,filter as I,takeUntil as u}from"rxjs/operators";import*as i from"@angular/core";import{InjectionToken as x,numberAttribute as p,booleanAttribute as O}from"@angular/core";import*as N from"@angular/cdk/bidi";var f=class{constructor(){this.expansionModel=new E(!0)}toggle(s){this.expansionModel.toggle(this._trackByValue(s))}expand(s){this.expansionModel.select(this._trackByValue(s))}collapse(s){this.expansionModel.deselect(this._trackByValue(s))}isExpanded(s){return this.expansionModel.isSelected(this._trackByValue(s))}toggleDescendants(s){this.expansionModel.isSelected(this._trackByValue(s))?this.collapseDescendants(s):this.expandDescendants(s)}collapseAll(){this.expansionModel.clear()}expandDescendants(s){let e=[s];e.push(...this.getDescendants(s)),this.expansionModel.select(...e.map(t=>this._trackByValue(t)))}collapseDescendants(s){let e=[s];e.push(...this.getDescendants(s)),this.expansionModel.deselect(...e.map(t=>this._trackByValue(t)))}_trackByValue(s){return this.trackBy?this.trackBy(s):s}},m=class extends f{constructor(s,e,t){super(),this.getLevel=s,this.isExpandable=e,this.options=t,this.options&&(this.trackBy=this.options.trackBy)}getDescendants(s){let e=this.dataNodes.indexOf(s),t=[];for(let r=e+1;r<this.dataNodes.length&&this.getLevel(s)<this.getLevel(this.dataNodes[r]);r++)t.push(this.dataNodes[r]);return t}expandAll(){this.expansionModel.select(...this.dataNodes.map(s=>this._trackByValue(s)))}},C=class extends f{constructor(s,e){super(),this.getChildren=s,this.options=e,this.options&&(this.trackBy=this.options.trackBy)}expandAll(){this.expansionModel.clear();let s=this.dataNodes.reduce((e,t)=>[...e,...this.getDescendants(t),t],[]);this.expansionModel.select(...s.map(e=>this._trackByValue(e)))}getDescendants(s){let e=[];return this._getDescendants(e,s),e.splice(1)}_getDescendants(s,e){s.push(e);let t=this.getChildren(e);Array.isArray(t)?t.forEach(r=>this._getDescendants(s,r)):y(t)&&t.pipe(S(1),I(Boolean)).subscribe(r=>{for(let o of r)this._getDescendants(s,o)})}},M=new x("CDK_TREE_NODE_OUTLET_NODE"),v=(()=>{class n{constructor(e,t){this.viewContainer=e,this._node=t}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(i.ViewContainerRef),i.\u0275\u0275directiveInject(M,8))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:n,selectors:[["","cdkTreeNodeOutlet",""]],standalone:!0})}}return n})(),D=class{constructor(s){this.$implicit=s}},R=(()=>{class n{constructor(e){this.template=e}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(i.TemplateRef))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:n,selectors:[["","cdkTreeNodeDef",""]],inputs:{when:["cdkTreeNodeDefWhen","when"]},standalone:!0})}}return n})();function G(){return Error("A valid data source must be provided.")}function J(){return Error("There can only be one default row without a when predicate function.")}function Y(){return Error("Could not find a matching node definition for the provided node data.")}function ee(){return Error("Could not find a tree control for the tree.")}function te(){return Error("Could not find functions for nested/flat tree in tree control.")}var g=(()=>{class n{get dataSource(){return this._dataSource}set dataSource(e){this._dataSource!==e&&this._switchDataSource(e)}constructor(e,t){this._differs=e,this._changeDetectorRef=t,this._onDestroy=new h,this._levels=new Map,this.viewChange=new b({start:0,end:Number.MAX_VALUE})}ngOnInit(){this._dataDiffer=this._differs.find([]).create(this.trackBy),this.treeControl}ngOnDestroy(){this._nodeOutlet.viewContainer.clear(),this.viewChange.complete(),this._onDestroy.next(),this._onDestroy.complete(),this._dataSource&&typeof this._dataSource.disconnect=="function"&&this.dataSource.disconnect(this),this._dataSubscription&&(this._dataSubscription.unsubscribe(),this._dataSubscription=null)}ngAfterContentChecked(){let e=this._nodeDefs.filter(t=>!t.when);e.length>1,this._defaultNodeDef=e[0],this.dataSource&&this._nodeDefs&&!this._dataSubscription&&this._observeRenderChanges()}_switchDataSource(e){this._dataSource&&typeof this._dataSource.disconnect=="function"&&this.dataSource.disconnect(this),this._dataSubscription&&(this._dataSubscription.unsubscribe(),this._dataSubscription=null),e||this._nodeOutlet.viewContainer.clear(),this._dataSource=e,this._nodeDefs&&this._observeRenderChanges()}_observeRenderChanges(){let e;T(this._dataSource)?e=this._dataSource.connect(this):y(this._dataSource)?e=this._dataSource:Array.isArray(this._dataSource)&&(e=w(this._dataSource)),e&&(this._dataSubscription=e.pipe(u(this._onDestroy)).subscribe(t=>this.renderNodeChanges(t)))}renderNodeChanges(e,t=this._dataDiffer,r=this._nodeOutlet.viewContainer,o){let d=t.diff(e);d&&(d.forEachOperation((a,_,l)=>{if(a.previousIndex==null)this.insertNode(e[l],l,r,o);else if(l==null)r.remove(_),this._levels.delete(a.item);else{let k=r.get(_);r.move(k,l)}}),this._changeDetectorRef.detectChanges())}_getNodeDef(e,t){if(this._nodeDefs.length===1)return this._nodeDefs.first;let r=this._nodeDefs.find(o=>o.when&&o.when(t,e))||this._defaultNodeDef;return r}insertNode(e,t,r,o){let d=this._getNodeDef(e,t),a=new D(e);this.treeControl.getLevel?a.level=this.treeControl.getLevel(e):typeof o<"u"&&this._levels.has(o)?a.level=this._levels.get(o)+1:a.level=0,this._levels.set(e,a.level),(r||this._nodeOutlet.viewContainer).createEmbeddedView(d.template,a,t),c.mostRecentTreeNode&&(c.mostRecentTreeNode.data=e)}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(i.IterableDiffers),i.\u0275\u0275directiveInject(i.ChangeDetectorRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:n,selectors:[["cdk-tree"]],contentQueries:function(t,r,o){if(t&1&&i.\u0275\u0275contentQuery(o,R,5),t&2){let d;i.\u0275\u0275queryRefresh(d=i.\u0275\u0275loadQuery())&&(r._nodeDefs=d)}},viewQuery:function(t,r){if(t&1&&i.\u0275\u0275viewQuery(v,7),t&2){let o;i.\u0275\u0275queryRefresh(o=i.\u0275\u0275loadQuery())&&(r._nodeOutlet=o.first)}},hostAttrs:["role","tree",1,"cdk-tree"],inputs:{dataSource:"dataSource",treeControl:"treeControl",trackBy:"trackBy"},exportAs:["cdkTree"],standalone:!0,features:[i.\u0275\u0275StandaloneFeature],decls:1,vars:0,consts:[["cdkTreeNodeOutlet",""]],template:function(t,r){t&1&&i.\u0275\u0275elementContainer(0,0)},dependencies:[v],encapsulation:2})}}return n})(),c=(()=>{class n{get role(){return"treeitem"}set role(e){this._elementRef.nativeElement.setAttribute("role",e)}static{this.mostRecentTreeNode=null}get data(){return this._data}set data(e){e!==this._data&&(this._data=e,this._setRoleFromData(),this._dataChanges.next())}get isExpanded(){return this._tree.treeControl.isExpanded(this._data)}get level(){return this._tree.treeControl.getLevel?this._tree.treeControl.getLevel(this._data):this._parentNodeAriaLevel}constructor(e,t){this._elementRef=e,this._tree=t,this._destroyed=new h,this._dataChanges=new h,n.mostRecentTreeNode=this,this.role="treeitem"}ngOnInit(){this._parentNodeAriaLevel=A(this._elementRef.nativeElement),this._elementRef.nativeElement.setAttribute("aria-level",`${this.level+1}`)}ngOnDestroy(){n.mostRecentTreeNode===this&&(n.mostRecentTreeNode=null),this._dataChanges.complete(),this._destroyed.next(),this._destroyed.complete()}focus(){this._elementRef.nativeElement.focus()}_setRoleFromData(){!this._tree.treeControl.isExpandable&&this._tree.treeControl.getChildren,this.role="treeitem"}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(g))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:n,selectors:[["cdk-tree-node"]],hostAttrs:[1,"cdk-tree-node"],hostVars:1,hostBindings:function(t,r){t&2&&i.\u0275\u0275attribute("aria-expanded",r.isExpanded)},inputs:{role:"role"},exportAs:["cdkTreeNode"],standalone:!0})}}return n})();function A(n){let s=n.parentElement;for(;s&&!B(s);)s=s.parentElement;return s?s.classList.contains("cdk-nested-tree-node")?p(s.getAttribute("aria-level")):0:-1}function B(n){let s=n.classList;return!!(s?.contains("cdk-nested-tree-node")||s?.contains("cdk-tree"))}var ie=(()=>{class n extends c{constructor(e,t,r){super(e,t),this._differs=r}ngAfterContentInit(){this._dataDiffer=this._differs.find([]).create(this._tree.trackBy),this._tree.treeControl.getChildren;let e=this._tree.treeControl.getChildren(this.data);Array.isArray(e)?this.updateChildrenNodes(e):y(e)&&e.pipe(u(this._destroyed)).subscribe(t=>this.updateChildrenNodes(t)),this.nodeOutlet.changes.pipe(u(this._destroyed)).subscribe(()=>this.updateChildrenNodes())}ngOnInit(){super.ngOnInit()}ngOnDestroy(){this._clear(),super.ngOnDestroy()}updateChildrenNodes(e){let t=this._getNodeOutlet();if(e&&(this._children=e),t&&this._children){let r=t.viewContainer;this._tree.renderNodeChanges(this._children,this._dataDiffer,r,this._data)}else this._dataDiffer.diff([])}_clear(){let e=this._getNodeOutlet();e&&(e.viewContainer.clear(),this._dataDiffer.diff([]))}_getNodeOutlet(){let e=this.nodeOutlet;return e&&e.find(t=>!t._node||t._node===this)}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(g),i.\u0275\u0275directiveInject(i.IterableDiffers))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:n,selectors:[["cdk-nested-tree-node"]],contentQueries:function(t,r,o){if(t&1&&i.\u0275\u0275contentQuery(o,v,5),t&2){let d;i.\u0275\u0275queryRefresh(d=i.\u0275\u0275loadQuery())&&(r.nodeOutlet=d)}},hostAttrs:[1,"cdk-nested-tree-node"],exportAs:["cdkNestedTreeNode"],standalone:!0,features:[i.\u0275\u0275ProvidersFeature([{provide:c,useExisting:n},{provide:M,useExisting:n}]),i.\u0275\u0275InheritDefinitionFeature]})}}return n})(),L=/([A-Za-z%]+)$/,ne=(()=>{class n{get level(){return this._level}set level(e){this._setLevelInput(e)}get indent(){return this._indent}set indent(e){this._setIndentInput(e)}constructor(e,t,r,o){this._treeNode=e,this._tree=t,this._element=r,this._dir=o,this._destroyed=new h,this.indentUnits="px",this._indent=40,this._setPadding(),o&&o.change.pipe(u(this._destroyed)).subscribe(()=>this._setPadding(!0)),e._dataChanges.subscribe(()=>this._setPadding())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_paddingIndent(){let e=this._treeNode.data&&this._tree.treeControl.getLevel?this._tree.treeControl.getLevel(this._treeNode.data):null,t=this._level==null?e:this._level;return typeof t=="number"?`${t*this._indent}${this.indentUnits}`:null}_setPadding(e=!1){let t=this._paddingIndent();if(t!==this._currentPadding||e){let r=this._element.nativeElement,o=this._dir&&this._dir.value==="rtl"?"paddingRight":"paddingLeft",d=o==="paddingLeft"?"paddingRight":"paddingLeft";r.style[o]=t||"",r.style[d]="",this._currentPadding=t}}_setLevelInput(e){this._level=isNaN(e)?null:e,this._setPadding()}_setIndentInput(e){let t=e,r="px";if(typeof e=="string"){let o=e.split(L);t=o[0],r=o[1]||r}this.indentUnits=r,this._indent=p(t),this._setPadding()}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(c),i.\u0275\u0275directiveInject(g),i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(N.Directionality,8))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:n,selectors:[["","cdkTreeNodePadding",""]],inputs:{level:["cdkTreeNodePadding","level",p],indent:["cdkTreeNodePaddingIndent","indent"]},standalone:!0,features:[i.\u0275\u0275InputTransformsFeature]})}}return n})(),se=(()=>{class n{constructor(e,t){this._tree=e,this._treeNode=t,this.recursive=!1}_toggle(e){this.recursive?this._tree.treeControl.toggleDescendants(this._treeNode.data):this._tree.treeControl.toggle(this._treeNode.data),e.stopPropagation()}static{this.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(g),i.\u0275\u0275directiveInject(c))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:n,selectors:[["","cdkTreeNodeToggle",""]],hostBindings:function(t,r){t&1&&i.\u0275\u0275listener("click",function(d){return r._toggle(d)})},inputs:{recursive:["cdkTreeNodeToggleRecursive","recursive",O]},standalone:!0,features:[i.\u0275\u0275InputTransformsFeature]})}}return n})();var re=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:n})}static{this.\u0275inj=i.\u0275\u0275defineInjector({})}}return n})();export{f as BaseTreeControl,M as CDK_TREE_NODE_OUTLET_NODE,ie as CdkNestedTreeNode,g as CdkTree,re as CdkTreeModule,c as CdkTreeNode,R as CdkTreeNodeDef,v as CdkTreeNodeOutlet,D as CdkTreeNodeOutletContext,ne as CdkTreeNodePadding,se as CdkTreeNodeToggle,m as FlatTreeControl,C as NestedTreeControl,te as getTreeControlFunctionsMissingError,ee as getTreeControlMissingError,Y as getTreeMissingMatchingNodeDefError,J as getTreeMultipleDefaultNodeDefsError,G as getTreeNoValidDataSourceError};
